more off
load cachedNamesLocationsAdj.mat

cityNames = {'1 SanFrancisco', ...
 '2 Chicago', ...
 '3 Atlanta', ...
 '4 Montreal', ...
 '5 Washington', ...
 '6 NewYork', ...
 '7 Madrid', ...
 '8 London', ...
 '9 Paris', ...
 '10 Essen', ...
 '11 Milan', ...
 '12 StPetersburg', ...
 '13 LosAngeles', ...
 '14 MexicoCity', ...
 '15 Lima', ...
 '16 Santiago', ...
 '17 Bogota', ...
 '18 Miami', ...
 '19 BuenosAires', ...
 '20 SaoPaulo', ...
 '21 Lagos', ...
 '22 Kinsasha', ...
 '23 Khartoum', ...
 '24 Johannesburg', ...
 '25 Algiers', ...
 '26 Cairo', ...
 '27 Istanbul', ...
 '28 Moscow', ...
 '29 Baghdad', ...
 '30 Riyadh', ...
 '31 Tehran', ...
 '32 Karachi', ...
 '33 Mumbai', ...
 '34 Delhi', ...
 '35 Chennai', ...
 '36 Kolkata', ...
 '37 Bangkok', ...
 '38 Jakarta', ...
 '39 Beijing', ...
 '40 HongKong', ...
 '41 HoChiMinhCity', ...
 '42 Shanghai', ...
 '43 Taipei', ...
 '44 Manila', ...
 '45 Seoul', ...
 '46 Osaka', ...
 '47 Tokyo', ...
 '48 Sydney'}

cityColorStrs = {'1 blue', ...
 '2 blue', ...
 '3 blue', ...
 '4 blue', ...
 '5 blue', ...
 '6 blue', ...
 '7 blue', ...
 '8 blue', ...
 '9 blue', ...
 '10 blue', ...
 '11 blue', ...
 '12 blue', ...
 '13 yellow', ...
 '14 yellow', ...
 '15 yellow', ...
 '16 yellow', ...
 '17 yellow', ...
 '18 yellow', ...
 '19 yellow', ...
 '20 yellow', ...
 '21 yellow', ...
 '22 yellow', ...
 '23 yellow', ...
 '24 yellow', ...
 '25 black', ...
 '26 black', ...
 '27 black', ...
 '28 black', ...
 '29 black', ...
 '30 black', ...
 '31 black', ...
 '32 black', ...
 '33 black', ...
 '34 black', ...
 '35 black', ...
 '36 black', ...
 '37 red', ...
 '38 red', ...
 '39 red', ...
 '40 red', ...
 '41 red', ...
 '42 red', ...
 '43 red', ...
 '44 red', ...
 '45 red', ...
 '46 red', ...
 '47 red', ...
 '48 red'}

cityColors = [repmat([0,0,1.0],[12,1]);repmat([0.8,0.75,0.0],[12,1]);repmat([0.0,0.0,0.0],[12,1]);repmat([1.0,0.0,0.0],[12,1])];

cityHexColors = [repmat('#0000FF',[12,1]);repmat('#FFFF00',[12,1]);repmat('#000000',[12,1]);repmat('#FF0000',[12,1])];

close all;
A = imread('pandemicMap.jpg');
h=figure(1);imagesc(single(A(:,:,3)));axis image;
set(h,'Position', [300 172 2240 1514])

% for iCITY = 1:numel(cityNames)
%   disp(cityNames{iCITY})
%   pause(0.01)
%   [x,y,b] = ginput(1)
%   xy(iCITY,:) = [x,y];
% end

xyCITY=[101.28, 296.08;...
    209.12, 262.21;...
    237.46, 325.80;...
    289.30, 260.83;...
    328.70, 321.66;...
    354.28, 273.27;...
    494.60, 301.61;...
    507.74, 222.12;...
    569.26, 263.59;...
    590.68, 208.29;...
    623.86, 247.69;...
    682.62, 193.08;...
    117.18, 378.34;...
    195.98, 405.30;...
    254.05, 567.05;...
    265.80, 656.91;...
    283.77, 477.19;...
    289.99, 390.78;...
    351.51, 643.78;...
    401.28, 578.80;...
    559.58, 461.98;...
    613.50, 518.66;...
    666.03, 448.15;...
    660.50, 602.99;...
    587.23, 350.00;...
    650.13, 365.90;...
    659.12, 295.39;...
    726.86, 247.00;...
    719.95, 337.55;...
    730.32, 412.21;...
    782.16, 286.40;...
    796.68, 367.28;...
    804.97, 426.03;...
    859.58, 345.85;...
    868.56, 470.27;...
    916.95, 361.06;...
    928.70, 430.87;...
    930.09, 540.78;...
    965.34, 268.43;...
    977.09, 394.24;...
    981.24, 488.25;...
    968.10, 325.11;...
   1045.52, 383.87;...
   1061.42, 484.10;...
   1037.92, 262.90;...
   1103.59, 358.29;...
   1095.98, 295.39;...
   1108.43, 653.45]

figure(3);
hold on;
for iCITY = 1:numel(cityNames)
  plot(xyCITY(iCITY,1),xyCITY(iCITY,2),'o','markersize',50,'linewidth',5,'color',cityColors(iCITY,:))
  text(xyCITY(iCITY,1),xyCITY(iCITY,2),cityNames{iCITY},'fontsize',20,'color',cityColors(iCITY,:))
end
axis ij;

Aadj = zeros(numel(cityNames));

bl = 1
while (bl == 1)  % stop when the button isn't the left button (bl = 1)
  [xl,yl,bl] = ginput(2);
  d1 = sqrt(sum([repmat([xl(1),yl(1)],[size(xyCITY,1),1]) - xyCITY].^2,2));
  d2 = sqrt(sum([repmat([xl(2),yl(2)],[size(xyCITY,1),1]) - xyCITY].^2,2));
  [minv1,mini1] = min(d1);
  [minv2,mini2] = min(d2);
  Aadj(mini1,mini2) = 1;
  plot([xyCITY(mini1,1);xyCITY(mini2,1)],[xyCITY(mini1,2);xyCITY(mini2,2)],'--','linewidth',5)
end

Asym = Aadj+Aadj';
% Show the adjacency matrix for cities
figure(4);
spy(Asym, '.k', 20)

cityNamesIndexed = 'cityNamesIndexed.csv';
cityColorsIndexed = 'cityColorsIndexed.csv';
cityHexColorsIndexed = 'cityHexColorsIndexed.csv';
cityMapXYIndexed = 'cityMapXYIndexed.csv';
cityMapAdjIndexed = 'cityMapAdjIndexed.csv';
cityColorStrsIndexed = 'cityColorStrsIndexed.csv';

fid = fopen(cityNamesIndexed, 'w+');
for iCITY=1:numel(cityNames)
    fprintf(fid, '%d, ', iCITY);
    fprintf(fid, '%s ', strtrim(cityNames{iCITY}(3:end)));
    fprintf(fid, '\n');
end
fclose(fid);

fid = fopen(cityMapXYIndexed, 'w+');
for iCITY=1:numel(cityNames)
    fprintf(fid, '%d, ', iCITY);
    fprintf(fid, '%f, ', xyCITY(iCITY,1));
    fprintf(fid, '%f ', xyCITY(iCITY,2));
    fprintf(fid, '\n');
end
fclose(fid);

dlmwrite(cityMapAdjIndexed, Asym, ',');

fid = fopen(cityColorsIndexed, 'w+');
for iCITY=1:numel(cityNames)
    fprintf(fid, '%d, ', iCITY);
    fprintf(fid, '%f, ', cityColors(iCITY,1));
    fprintf(fid, '%f, ', cityColors(iCITY,2));
    fprintf(fid, '%f ', cityColors(iCITY,3));
    fprintf(fid, '\n');
end
fclose(fid);

fid = fopen(cityHexColorsIndexed, 'w+');
for iCITY=1:numel(cityNames)
    fprintf(fid, '%d, ', iCITY);
    fprintf(fid, '%s ', cityHexColors(iCITY,:));
    fprintf(fid, '\n');
end
fclose(fid);

fid = fopen(cityColorStrsIndexed, 'w+');
for iCITY=1:numel(cityNames)
    fprintf(fid, '%d, ', iCITY);
    fprintf(fid, '%s ', strtrim(cityColorStrs{iCITY}(3:end)));
    fprintf(fid, '\n');
end
fclose(fid);


% save cachedNamesLocationsAdj.mat


